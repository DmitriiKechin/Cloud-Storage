<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script defer>
      (async () => {
        const response = await fetch(`/api/share/getPublicKey`);
        try {
          if (!response.ok) {
            throw new Error();
          }

          const publicKey = (await response.json()).link;

          const url = new URL(
            `https://cloud-api.yandex.net/v1/disk/public/resources/download?public_key=${publicKey}`
          );
          const responseUrlDownload = await fetch(url.toString());

          if (!responseUrlDownload.ok) {
            throw new Error('Error download');
          }

          const urlDownload = await responseUrlDownload.json();

          const file = await fetch(urlDownload.href);

          if (!file.ok) {
            throw new Error();
          }

          const blob = await file.blob();
          const downloadUrl = window.URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = downloadUrl;
          link.download = true;
          document.body.appendChild(link);
          link.click();
          link.remove();
        } catch (err) {
          const header = document.createElement('h1');
          header.textContent = 'Файл не найден';
          document.body.appendChild(header);
        }
      })();
    </script>
  </body>
</html>
